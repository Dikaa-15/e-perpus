<!-- Hero Section with Library Background -->
<div class="relative bg-gradient-to-r from-blue-800 to-blue-600 text-white py-20 mb-12 rounded-lg shadow-xl overflow-hidden">
    <div class="absolute inset-0 bg-[url('data:image/svg+xml,%3Csvg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" xmlns=\"http://www.w3.org/2000/svg\"%3E%3Cg fill=\"%23ffffff\" fill-opacity=\"0.1\" fill-rule=\"evenodd\"%3E%3Ccircle cx=\"3\" cy=\"3\" r=\"3\"/%3E%3Ccircle cx=\"13\" cy=\"13\" r=\"3\"/%3E%3C/g%3E%3C/svg%3E')] opacity-20"></div>
    <div class="container mx-auto px-6">
        <div class="text-center relative z-10">
            <h1 class="text-5xl md:text-7xl font-bold mb-8 animate-fade-in">E-Perpustakaan</h1>
            
            <!-- Glassmorphism Typing Animation -->
            <div class="glassmorphism-hero max-w-2xl mx-auto p-6 rounded-xl backdrop-blur-md bg-white/10 border border-white/20 mb-10">
                <div id="typing-text" class="text-xl md:text-2xl text-blue-100 font-light h-8 min-h-[2rem] flex items-center justify-center"></div>
            </div>
            
            <% if (!user) { %>
                <div class="flex flex-col sm:flex-row gap-4 justify-center items-center">
                    <a href="/auth/register" class="bg-white text-blue-800 hover:bg-blue-50 px-8 py-4 rounded-lg font-semibold transition-all duration-300 inline-block hover:shadow-lg transform hover:-translate-y-1">
                        <i class="fas fa-user-plus mr-2"></i> Daftar Sekarang
                    </a>
                    <a href="/auth/login" class="border-2 border-white text-white hover:bg-white hover:text-blue-800 px-8 py-4 rounded-lg font-semibold transition-all duration-300 inline-block hover:shadow-lg transform hover:-translate-y-1">
                        <i class="fas fa-sign-in-alt mr-2"></i> Masuk
                    </a>
                </div>
            <% } else { %>
                <div class="glassmorphism-welcome max-w-lg mx-auto p-8 rounded-xl backdrop-blur-md bg-white/10 border border-white/20">
                    <div class="flex items-center justify-center space-x-4">
                        <div class="bg-white/20 rounded-full py-1 px-2">
                            <i class="fas fa-user-circle text-2xl text-white"></i>
                        </div>
                        <div class="text-left">
                            <p class="text-lg text-blue-100">Selamat datang kembali,</p>
                            <p class="text-2xl font-semibold text-white"><%= user.name %></p>
                        </div>
                    </div>
                </div>
            <% } %>
        </div>
    </div>
</div>

<!-- Quick Stats with Book-themed Design -->
<div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-16 pt-14 pb-16">
    <div class="bg-gradient-to-br from-blue-50 to-white rounded-xl shadow-lg p-8 border-l-8 border-blue-600 transition-all duration-300">
        <div class="flex items-center">
            <div class="bg-blue-100 w-20 h-20 rounded-lg flex items-center justify-center shadow-inner">
                <i class="fas fa-book-open text-3xl text-blue-600"></i>
            </div>
            <div class="ml-6">
                <h3 class="text-xl font-semibold text-gray-800 mb-2">Total Buku</h3>
                <p class="text-4xl font-bold text-blue-600"><%= stats.totalBooks %></p>
            </div>
        </div>
    </div>
    
    <div class="bg-gradient-to-br from-blue-50 to-white rounded-xl shadow-lg p-8 border-l-8 border-blue-600 transition-all duration-300">
        <div class="flex items-center">
            <div class="bg-blue-100 w-20 h-20 rounded-lg flex items-center justify-center shadow-inner">
                <i class="fas fa-th-large text-3xl text-blue-600"></i>
            </div>
            <div class="ml-6">
                <h3 class="text-xl font-semibold text-gray-800 mb-2">Kategori</h3>
                <p class="text-4xl font-bold text-blue-600"><%= stats.totalCategories %></p>
            </div>
        </div>
    </div>
</div>

<!-- Category Navigation Tabs -->
<div class="mb-12 text-center mx-auto">
    <h2 class="text-3xl font-bold text-gray-800 mb-6 flex items-center justify-center">
        <span class="bg-blue-100 w-12 h-12 rounded-lg flex items-center justify-center mr-4">
            <i class="fas fa-th-large text-blue-600"></i>
        </span>
        Kategori Buku
    </h2>
    
    <div class="bg-white rounded-xl shadow-lg overflow-hidden">
        <nav class="flex overflow-x-auto" id="categoryTabs">
            <button onclick="filterBooks('all')" 
                    class="category-tab active min-w-[120px] px-6 py-4 text-gray-700 hover:text-blue-600 border-b-2 border-transparent hover:border-blue-600 transition-all duration-300">
                <i class="fas fa-books mr-2"></i>Semua
            </button>
            
            <% if (categories && categories.length > 0) { %>
                <% categories.forEach(category => { 
                    const iconClass = {
                        'fiction': 'fas fa-book',
                        'non-fiction': 'fas fa-book-open',
                        'science': 'fas fa-flask',
                        'technology': 'fas fa-laptop-code',
                        'history': 'fas fa-history',
                        'biography': 'fas fa-user',
                        'mathematics': 'fas fa-calculator',
                        'literature': 'fas fa-feather-alt'
                    }[category.slug] || 'fas fa-book';
                %>
                    <button onclick="filterBooks('<%= category.slug %>')"
                            class="category-tab min-w-[120px] px-6 py-4 text-gray-700 hover:text-blue-600 border-b-2 border-transparent hover:border-blue-600 transition-all duration-300">
                        <i class="<%= iconClass %> mr-2"></i><%= category.name %>
                    </button>
                <% }); %>
            <% } %>
        </nav>
    </div>
</div>

<!-- Featured Books Section -->
<div class="mb-16">
    <div id="booksContainer" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
        <% if (featuredBooks && featuredBooks.length > 0) { %>
            <% featuredBooks.forEach(book => { %>
                <div class="book-card" data-category="<%= book.category_name?.toLowerCase()?.replace(/\s+/g, '-') || 'uncategorized' %>">
                    <div class="bg-white rounded-lg shadow-lg overflow-hidden transition-all duration-300">
                        <div class="h-48 bg-blue-100 relative">
                            <% if (book.cover) { %>
                                <img src="<%= book.cover %>" alt="<%= book.name %>" class="w-full h-full object-cover">
                            <% } else { %>
                                <div class="w-full h-full flex items-center justify-center">
                                    <i class="fas fa-book text-5xl text-blue-300"></i>
                                </div>
                            <% } %>
                            <% if (book.is_popular) { %>
                                <div class="absolute top-2 right-2 bg-yellow-400 text-yellow-900 px-2 py-1 rounded-full text-xs font-semibold">
                                    <i class="fas fa-star mr-1"></i> Popular
                                </div>
                            <% } %>
                        </div>
                        <div class="p-6">
                            <div class="text-xs text-blue-600 font-semibold mb-2"><%= book.category_name || 'Uncategorized' %></div>
                            <h3 class="text-lg font-semibold text-gray-800 mb-2"><%= book.name %></h3>
                            <p class="text-gray-600 text-sm mb-2"><%= book.author || 'Unknown Author' %></p>
                            <div class="flex justify-between items-center mt-4">
                                <span class="text-sm text-gray-500"><%= book.year_publisher || '' %></span>
                                <span class="px-2 py-1 rounded-full text-xs <%= book.is_available ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800' %>">
                                    <%= book.is_available ? 'Available' : 'Not Available' %>
                                </span>
                            </div>
                            <% if (user && book.is_available) { %>
                                <button data-book-id="<%= book.id %>" 
                                        data-book-title="<%= book.name %>"
                                        class="borrow-btn w-full mt-4 bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors duration-300">
                                    <i class="fas fa-book-reader mr-2"></i> Pinjam Buku
                                </button>
                            <% } else if (!user && book.is_available) { %>
                                <a href="/auth/login" class="block text-center w-full mt-4 bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors duration-300">
                                    <i class="fas fa-sign-in-alt mr-2"></i> Login untuk Meminjam
                                </a>
                            <% } %>
                        </div>
                    </div>
                </div>
            <% }); %>
        <% } else { %>
            <div class="col-span-4 text-center py-8">
                <div class="text-gray-500">No books available at the moment.</div>
            </div>
        <% } %>
    </div>
</div>

<!-- Library Services -->
<div class="bg-gradient-to-br from-blue-50 via-white to-blue-50 rounded-xl shadow-xl p-12 mb-12">
    <h2 class="text-3xl font-bold text-gray-800 text-center mb-12 flex items-center justify-center">
        <span class="bg-blue-100 w-12 h-12 rounded-lg flex items-center justify-center mr-4">
            <i class="fas fa-concierge-bell text-blue-600"></i>
        </span>
        Layanan Perpustakaan
    </h2>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
        <div class="bg-white p-6 rounded-xl shadow-lg text-center transform hover:scale-105 transition-all duration-300">
            <div class="bg-blue-100 w-16 h-16 rounded-lg flex items-center justify-center mx-auto mb-4">
                <i class="fas fa-book-reader text-2xl text-blue-600"></i>
            </div>
            <h3 class="font-semibold text-gray-800 mb-3">Peminjaman Digital</h3>
            <p class="text-gray-600">Pinjam dan baca buku secara digital kapan saja</p>
        </div>
        
        <div class="bg-white p-6 rounded-xl shadow-lg text-center transform hover:scale-105 transition-all duration-300">
            <div class="bg-blue-100 w-16 h-16 rounded-lg flex items-center justify-center mx-auto mb-4">
                <i class="fas fa-bookmark text-2xl text-blue-600"></i>
            </div>
            <h3 class="font-semibold text-gray-800 mb-3">Bookmark</h3>
            <p class="text-gray-600">Simpan dan tandai buku favorit Anda</p>
        </div>
        
        <div class="bg-white p-6 rounded-xl shadow-lg text-center transform hover:scale-105 transition-all duration-300">
            <div class="bg-blue-100 w-16 h-16 rounded-lg flex items-center justify-center mx-auto mb-4">
                <i class="fas fa-history text-2xl text-blue-600"></i>
            </div>
            <h3 class="font-semibold text-gray-800 mb-3">Riwayat Bacaan</h3>
            <p class="text-gray-600">Pantau aktivitas membaca Anda</p>
        </div>
    </div>
</div>

<!-- Borrow Modal -->
<div id="borrowModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
    <div class="bg-white rounded-xl shadow-2xl p-8 max-w-lg w-full mx-4 transform transition-all max-h-[90vh] overflow-y-auto">
        <div class="text-center mb-6">
            <div class="bg-blue-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                <i class="fas fa-book-reader text-2xl text-blue-600"></i>
            </div>
            <h3 class="text-2xl font-bold text-gray-800 mb-2">Form Peminjaman Buku</h3>
            <p id="bookTitle" class="text-gray-600 font-semibold"></p>
        </div>
        
        <form id="borrowForm" class="space-y-4">
            <input type="hidden" id="bookId" name="book_id">
            
            <!-- Loan Date -->
            <div>
                <label for="loansDate" class="block text-sm font-semibold text-gray-700 mb-2">
                    <i class="fas fa-calendar-alt mr-2 text-blue-600"></i>Tanggal Peminjaman
                </label>
                <input type="date" id="loansDate" name="loans_date" 
                       class="w-full px-4 py-3 border-2 border-blue-200 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all duration-300"
                       required>
            </div>
            
            <!-- Loan Duration -->
            <div>
                <label for="loanDuration" class="block text-sm font-semibold text-gray-700 mb-2">
                    <i class="fas fa-clock mr-2 text-blue-600"></i>Durasi Peminjaman
                </label>
                <select id="loanDuration" name="loan_duration" 
                        class="w-full px-4 py-3 border-2 border-blue-200 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all duration-300"
                        required>
                    <option value="">Pilih durasi peminjaman</option>
                    <option value="7">7 hari</option>
                    <option value="14">14 hari (2 minggu)</option>
                    <option value="21">21 hari (3 minggu)</option>
                    <option value="30">30 hari (1 bulan)</option>
                </select>
            </div>
            
            <!-- Due Date (Auto calculated) -->
            <div>
                <label for="dueDate" class="block text-sm font-semibold text-gray-700 mb-2">
                    <i class="fas fa-calendar-check mr-2 text-blue-600"></i>Tanggal Jatuh Tempo
                </label>
                <input type="date" id="dueDate" name="due_date" 
                       class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg bg-gray-50 cursor-not-allowed"
                       readonly>
                <p class="text-xs text-gray-500 mt-1">Otomatis dihitung berdasarkan tanggal peminjaman dan durasi</p>
            </div>
            
            <!-- Notes/Purpose -->
            <div>
                <label for="borrowPurpose" class="block text-sm font-semibold text-gray-700 mb-2">
                    <i class="fas fa-sticky-note mr-2 text-blue-600"></i>Tujuan Peminjaman (Opsional)
                </label>
                <textarea id="borrowPurpose" name="purpose" rows="3"
                          class="w-full px-4 py-3 border-2 border-blue-200 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all duration-300 resize-none"
                          placeholder="Contoh: Untuk tugas kuliah, penelitian, bacaan pribadi, dll."></textarea>
            </div>
            
            <!-- Terms and Conditions -->
            <div class="bg-blue-50 p-4 rounded-lg">
                <h4 class="font-semibold text-gray-800 mb-2 flex items-center">
                    <i class="fas fa-info-circle mr-2 text-blue-600"></i>Syarat dan Ketentuan
                </h4>
                <ul class="text-sm text-gray-600 space-y-1">
                    <li>• Buku harus dikembalikan sesuai tanggal jatuh tempo</li>
                    <li>• Denda keterlambatan Rp 1.000 per hari</li>
                    <li>• Maksimal peminjaman 5 buku per anggota</li>
                    <li>• Buku yang rusak/hilang akan dikenakan denda penggantian</li>
                </ul>
                <div class="mt-3">
                    <label class="flex items-center">
                        <input type="checkbox" id="agreeTerms" required 
                               class="w-4 h-4 text-blue-600 border-2 border-gray-300 rounded focus:ring-blue-500">
                        <span class="ml-2 text-sm text-gray-700">Saya setuju dengan syarat dan ketentuan di atas</span>
                    </label>
                </div>
            </div>
            
            <div class="flex gap-4 pt-4">
                <button type="button" onclick="closeBorrowModal()" 
                        class="flex-1 px-6 py-3 border-2 border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors duration-300">
                    <i class="fas fa-times mr-2"></i>Batal
                </button>
                <button type="submit" 
                        class="flex-1 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors duration-300">
                    <i class="fas fa-book-reader mr-2"></i>Pinjam Buku
                </button>
            </div>
        </form>
    </div>
    <% } else { %>
    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-6">
        <% popularBooks.forEach(book => { %>
        <div class="bg-white rounded-lg shadow-lg overflow-hidden hover:shadow-xl transition-shadow duration-300">
            <img src="<%= book.cover || '/images/default-book-cover.png' %>" alt="<%= book.name %>" class="w-full h-48 object-cover">
            <div class="p-4">
                <h3 class="font-semibold text-lg text-gray-800 mb-2"><%= book.name %></h3>
                <p class="text-gray-600 text-sm">Penulis: <%= book.author || 'Tidak diketahui' %></p>
            </div>
        </div>
        <% }) %>
    </div>
    <% } %>
</div>

<!-- Success/Error Messages -->
<div id="messageContainer" class="fixed top-4 right-4 z-50"></div>

<style>
@keyframes fade-in {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

.animate-fade-in {
    animation: fade-in 1s ease-out;
}

.glassmorphism-hero {
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(15px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
    animation: glassmorphism-float 3s ease-in-out infinite;
}

.glassmorphism-welcome {
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(15px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
    animation: glassmorphism-float 3s ease-in-out infinite;
}

@keyframes glassmorphism-float {
    0%, 100% { transform: translateY(0px); }
    50% { transform: translateY(-10px); }
}

@keyframes cursor-blink {
    0%, 100% { opacity: 1; }
    50% { opacity: 0; }
}

.cursor::after {
    content: '|';
    animation: cursor-blink 1s infinite;
    margin-left: 2px;
    color: #dbeafe;
}

.category-tab.active {
    color: #2563eb;
    border-bottom-color: #2563eb;
}

.book-card {
    transition: all 0.3s ease;
}

.book-card.hidden {
    display: none;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Typing animation
    const typingText = document.getElementById('typing-text');
    const messages = [
        'Selamat Datang di Perpustakaan Digital',
        'Jelajahi Dunia Pengetahuan Melalui Koleksi Digital Kami',
        'Temukan Ribuan Buku dan Artikel Menarik',
        'Baca Dimana Saja, Kapan Saja'
    ];

    function typeWriter(element, text, i, callback) {
        if (i < text.length) {
            element.classList.add('cursor');
            element.innerHTML = text.substring(0, i + 1);
            setTimeout(() => typeWriter(element, text, i + 1, callback), 100);
        } else {
            setTimeout(() => {
                element.classList.remove('cursor');
                if (callback) setTimeout(callback, 2000);
            }, 1500);
        }
    }

    function eraseText(element, callback) {
        let text = element.innerHTML;
        let i = text.length;
        
        function erase() {
            if (i > 0) {
                element.classList.add('cursor');
                element.innerHTML = text.substring(0, i - 1);
                i--;
                setTimeout(erase, 50);
            } else {
                element.classList.remove('cursor');
                if (callback) setTimeout(callback, 500);
            }
        }
        setTimeout(erase, 1500);
    }

    let messageIndex = 0;
    function animateTypingText() {
        typeWriter(typingText, messages[messageIndex], 0, () => {
            eraseText(typingText, () => {
                messageIndex = (messageIndex + 1) % messages.length;
                animateTypingText();
            });
        });
    }

    // Start the animation
    animateTypingText();

    // Category filtering
    window.filterBooks = function(category) {
        // Update active tab
        document.querySelectorAll('.category-tab').forEach(tab => {
            tab.classList.remove('active');
        });
        event.currentTarget.classList.add('active');

        // Filter books
        const books = document.querySelectorAll('.book-card');
        books.forEach(book => {
            if (category === 'all' || book.dataset.category === category) {
                book.classList.remove('hidden');
            } else {
                book.classList.add('hidden');
            }
        });
    }

    // Set up borrow button click handlers
    document.querySelectorAll('.borrow-btn').forEach(button => {
        button.addEventListener('click', function() {
            const bookId = this.dataset.bookId;
            const bookTitle = this.dataset.bookTitle;
            openBorrowModal(bookId, bookTitle);
        });
    });
});

// Borrow Modal Functions
function openBorrowModal(bookId, bookTitle) {
    document.getElementById('bookId').value = bookId;
    document.getElementById('bookTitle').textContent = bookTitle;
    
    // Set default loan date to today
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('loansDate').value = today;
    
    document.getElementById('borrowModal').classList.remove('hidden');
    document.body.style.overflow = 'hidden';
}

function closeBorrowModal() {
    document.getElementById('borrowModal').classList.add('hidden');
    document.body.style.overflow = 'auto';
    document.getElementById('borrowForm').reset();
}

// Calculate due date when loan date or duration changes
function calculateDueDate() {
    const loansDate = document.getElementById('loansDate').value;
    const loanDuration = document.getElementById('loanDuration').value;
    
    if (loansDate && loanDuration) {
        const startDate = new Date(loansDate);
        const dueDate = new Date(startDate);
        dueDate.setDate(dueDate.getDate() + parseInt(loanDuration));
        
        const formattedDueDate = dueDate.toISOString().split('T')[0];
        document.getElementById('dueDate').value = formattedDueDate;
    }
}

// Add event listeners for date calculation
document.getElementById('loansDate')?.addEventListener('change', calculateDueDate);
document.getElementById('loanDuration')?.addEventListener('change', calculateDueDate);

// Handle form submission
document.getElementById('borrowForm')?.addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const formData = new FormData(this);
    const bookId = formData.get('book_id');
    const loansDate = formData.get('loans_date');
    const loanDuration = formData.get('loan_duration');
    const dueDate = formData.get('due_date');
    const purpose = formData.get('purpose');
    const agreeTerms = document.getElementById('agreeTerms').checked;
    
    // Validation
    if (!loansDate) {
        showMessage('Silakan pilih tanggal peminjaman', 'error');
        return;
    }
    
    if (!loanDuration) {
        showMessage('Silakan pilih durasi peminjaman', 'error');
        return;
    }
    
    if (!agreeTerms) {
        showMessage('Anda harus menyetujui syarat dan ketentuan', 'error');
        return;
    }
    
    // Validate loan date (not in the past)
    const today = new Date().toISOString().split('T')[0];
    if (loansDate < today) {
        showMessage('Tanggal peminjaman tidak boleh di masa lalu', 'error');
        return;
    }
    
    try {
        const response = await fetch('/loans', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                book_id: parseInt(bookId),
                loans_date: loansDate,
                loan_duration: parseInt(loanDuration),
                due_date: dueDate,
                purpose: purpose || null
            })
        });
        
        const result = await response.json();
        
        if (result.success) {
            showMessage('Buku berhasil dipinjam!', 'success');
            closeBorrowModal();
            // Optionally refresh the page to update book availability
            setTimeout(() => {
                window.location.reload();
            }, 2000);
        } else {
            showMessage(result.error || 'Terjadi kesalahan saat meminjam buku', 'error');
        }
    } catch (error) {
        console.error('Error:', error);
        showMessage('Terjadi kesalahan saat meminjam buku', 'error');
    }
});

// Show success/error messages
function showMessage(message, type) {
    const messageContainer = document.getElementById('messageContainer');
    const messageDiv = document.createElement('div');
    
    const bgColor = type === 'success' ? 'bg-green-500' : 'bg-red-500';
    const icon = type === 'success' ? 'fas fa-check-circle' : 'fas fa-exclamation-circle';
    
    messageDiv.className = `${bgColor} text-white px-6 py-4 rounded-lg shadow-lg mb-4 transform transition-all duration-300 translate-x-full`;
    messageDiv.innerHTML = `
        <div class="flex items-center">
            <i class="${icon} mr-3"></i>
            <span>${message}</span>
        </div>
    `;
    
    messageContainer.appendChild(messageDiv);
    
    // Animate in
    setTimeout(() => {
        messageDiv.classList.remove('translate-x-full');
    }, 100);
    
    // Remove after 5 seconds
    setTimeout(() => {
        messageDiv.classList.add('translate-x-full');
        setTimeout(() => {
            messageContainer.removeChild(messageDiv);
        }, 300);
    }, 5000);
}

// Close modal when clicking outside
document.getElementById('borrowModal')?.addEventListener('click', function(e) {
    if (e.target === this) {
        closeBorrowModal();
    }
});
</script>
